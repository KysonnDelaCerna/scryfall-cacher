name: Scheduled Index

on:
  schedule:
    - cron: "0 12 * * *"
  workflow_dispatch:

jobs:
  build-and-index:
    runs-on: "ubuntu-latest"

    steps:
      - name: "Set Timezone"
        uses: "szenius/set-timezone@v1.2"
        with:
          timezoneLinux: "Asia/Singapore"
      - name: "Checkout"
        uses: "actions/checkout@v3"
      - name: "Install Dependencies"
        uses: mskelton/setup-yarn@v1
        with:
          node-version: "16.x"
      - name: "Set Environment Variables"
        run: |
          touch .env
          echo PROJECT_ID="${{ secrets.PROJECT_ID }}" >> .env
          echo PRIVATE_KEY="${{ secrets.PRIVATE_KEY }}" >> .env
          echo CLIENT_EMAIL="${{ secrets.CLIENT_EMAIL }}" >> .env
      - name: "Index"
        run: "yarn tsc main.ts && node main.js"
